# Docker Compose dla Price Checker na minipc
# Uruchamia Chrome z VNC do podgladu i mozliwosci logowania
#
# Uzycie:
#   docker-compose -f docker-compose.price-checker-vnc.yml up -d
#   
# Polacz sie przez VNC na port 5900 (haslo: secret)
# Zaloguj sie na Allegro w przegladarce
# Uruchom scraper:
#   docker exec price-checker-browser python /app/price_checker_cdp.py --check-offers

version: "3.8"

services:
  # Chrome z VNC do podgladu
  chrome-vnc:
    image: selenium/standalone-chrome:latest
    container_name: price-checker-browser
    ports:
      - "5900:5900"  # VNC
      - "7900:7900"  # noVNC (przegladarka)
      - "9222:4444"  # Selenium (opcjonalnie)
    environment:
      - SE_VNC_PASSWORD=secret
      - SE_SCREEN_WIDTH=1920
      - SE_SCREEN_HEIGHT=1080
      - SE_NODE_MAX_SESSIONS=1
      - SE_SESSION_RETRY_INTERVAL=1
    volumes:
      - chrome-data:/home/seluser/.config/google-chrome
    shm_size: "2gb"
    restart: unless-stopped

  # Alternatywa: Chromium z Xvfb i VNC (lzejsze)
  chromium-vnc:
    build:
      context: .
      dockerfile: Dockerfile.chromium-vnc
    container_name: price-checker-chromium
    ports:
      - "5901:5900"  # VNC
      - "9223:9222"  # CDP
    volumes:
      - ./magazyn/scripts:/app:ro
      - chromium-data:/root/.config/chromium
    environment:
      - DISPLAY=:99
    shm_size: "2gb"
    restart: unless-stopped
    profiles:
      - chromium  # Uruchom z: docker-compose --profile chromium up

volumes:
  chrome-data:
  chromium-data:

networks:
  default:
    name: price-checker-network
