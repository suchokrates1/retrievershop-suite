name: Deploy to Production

on:
  push:
    branches:
      - main
  workflow_dispatch: # Pozwala na rÄ™czne uruchomienie z UI

jobs:
  deploy:
    name: Deploy to RPi5 Production
    runs-on: [self-hosted, linux, ARM64, retrievershop]  # â† Dodaj label!
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Pull latest changes
        run: |
          cd /home/suchokrates1/retrievershop-suite
          git pull origin main
          echo "âœ… Code updated to latest version"
      
      - name: Restart Docker containers
        run: |
          cd /home/suchokrates1/retrievershop-suite
          docker compose down || true
          docker compose up -d --build
          echo "âœ… Containers restarted"
      
      - name: Verify deployment
        run: |
          cd /home/suchokrates1/retrievershop-suite
          echo "ğŸ” Checking containers..."
          docker compose ps
          echo ""
          echo "ğŸ“‹ Recent logs:"
          docker compose logs magazyn_app --tail=20
          echo ""
          echo "âœ… Deployment completed successfully!"
