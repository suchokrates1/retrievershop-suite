{% extends "base.html" %}

{% block content %}
<h2 class="mb-3 text-center">Ustawienia sprzedaży</h2>
<form method="post" class="row row-cols-1 row-cols-md-2 g-3 center-form mx-auto">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <table class="table">
        <tbody>
        {% for item in settings %}
        <tr>
            <th scope="row">
                {{ item.label }}
                {% if item.desc %}<br><small class="text-muted">{{ item.desc }}</small>{% endif %}
                {% if item.label != item.key %}<br><small class="text-muted">{{ item.key }}</small>{% endif %}
            </th>
            <td>
                <input type="number" step="0.01" class="form-control" id="{{ item.key }}" name="{{ item.key }}" value="{{ item.value }}">
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

    <h5 class="mt-4 text-center">Progi kosztów wysyłki</h5>
    <table class="table" id="thresholdTable">
        <thead>
        <tr>
            <th>Minimalna wartość zamówienia</th>
            <th>Koszt wysyłki</th>
            <th></th>
        </tr>
        </thead>
        <tbody id="thresholdRows">
        {% for t in thresholds %}
        <tr class="threshold-row">
            <td><input type="number" step="0.01" class="form-control" name="threshold_min" value="{{ '%.2f'|format(t.min_order_value) }}"></td>
            <td><input type="number" step="0.01" class="form-control" name="threshold_cost" value="{{ '%.2f'|format(t.shipping_cost) }}"></td>
            <td><button type="button" class="btn btn-danger btn-sm remove-row">Usuń</button></td>
        </tr>
        {% endfor %}
        {% if thresholds|length == 0 %}
        <tr class="threshold-row">
            <td><input type="number" step="0.01" class="form-control" name="threshold_min"></td>
            <td><input type="number" step="0.01" class="form-control" name="threshold_cost"></td>
            <td><button type="button" class="btn btn-danger btn-sm remove-row">Usuń</button></td>
        </tr>
        {% endif %}
        </tbody>
    </table>
    <div class="col-12 text-center mb-3">
        <button type="button" id="addThresholdRow" class="btn btn-secondary">Dodaj próg</button>
    </div>
    <div class="col-12 form-actions text-center">
        <button type="submit" class="btn btn-primary">Zapisz</button>
    </div>
</form>
<script>
    document.getElementById('addThresholdRow').addEventListener('click', () => {
        const container = document.getElementById('thresholdRows');
        const row = container.querySelector('.threshold-row').cloneNode(true);
        row.querySelectorAll('input').forEach(i => i.value = '');
        container.appendChild(row);
    });
    document.addEventListener('click', e => {
        if (e.target.classList.contains('remove-row')) {
            const rows = document.querySelectorAll('.threshold-row');
            if (rows.length > 1) {
                e.target.closest('.threshold-row').remove();
            }
        }
    });
</script>
{% endblock %}
